import{a as ne}from"./chunk-YBQKBANH.js";import{a as j,b as C,c as G,d as L,e as q,g as z,h as H,i as ie,j as oe,k as re,m as Y,n as Z}from"./chunk-OQPCJW4C.js";import{$ as h,B as K,E as l,F as b,J as u,L as m,N as B,O as g,P as I,Q as T,R as n,S as i,T as f,U as P,V as c,W as d,X as r,Y as S,Z as O,a as E,aa as $,b as y,ba as A,ia as ee,ja as V,ka as w,la as te,n as W,q as X,ra as N,s as _,ta as R,w as x,x as v,y as F,z as D}from"./chunk-DORITJJS.js";function ce(t,s){if(t&1){let e=P();n(0,"div",1)(1,"div",2)(2,"h3"),r(3,"Ban User"),i(),n(4,"p",3),r(5),i(),n(6,"form",4),c("ngSubmit",function(){x(e);let a=d();return v(a.onSubmit())}),n(7,"div",5)(8,"label",6),r(9,"Ban Reason"),i(),n(10,"textarea",7),r(11,"        "),i()(),n(12,"div",5)(13,"label",8),r(14,"Ban Duration"),i(),n(15,"select",9)(16,"option",10),r(17,"1 day"),i(),n(18,"option",11),r(19,"1 week"),i(),n(20,"option",12),r(21,"1 month"),i(),n(22,"option",13),r(23,"3 months"),i(),n(24,"option",14),r(25,"6 months"),i(),n(26,"option",15),r(27,"1 year"),i(),n(28,"option",16),r(29,"Permanent"),i()()(),n(30,"div",17)(31,"button",18),c("click",function(){x(e);let a=d();return v(a.onCancel())}),r(32,"Cancel"),i(),n(33,"button",19),r(34,"Confirm Ban"),i()()()()()}if(t&2){let e=d();l(5),S(e.userEmail),l(),m("formGroup",e.banForm),l(27),m("disabled",e.banForm.invalid)}}var J=(()=>{class t{constructor(e){this.fb=e,this.isOpen=!1,this.userEmail="",this.close=new K,this.confirm=new K,this.banForm=this.fb.group({reason:["",[C.required,C.minLength(10)]],duration:["7",C.required]})}onSubmit(){if(this.banForm.valid){let{reason:e,duration:o}=this.banForm.value;this.confirm.emit({reason:e,duration:Number(o)}),this.banForm.reset({duration:"7"}),this.close.emit()}}onCancel(){this.close.emit(),this.banForm.reset({duration:"7"})}static{this.\u0275fac=function(o){return new(o||t)(b(Y))}}static{this.\u0275cmp=_({type:t,selectors:[["ban-dialog"]],inputs:{isOpen:"isOpen",userEmail:"userEmail"},outputs:{close:"close",confirm:"confirm"},standalone:!0,features:[h],decls:1,vars:1,consts:[["class","dialog-overlay",4,"ngIf"],[1,"dialog-overlay"],[1,"dialog-content"],[1,"user-email"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","reason"],["id","reason","formControlName","reason","placeholder","Enter the reason for banning this user","rows","3"],["for","duration"],["id","duration","formControlName","duration"],["value","1"],["value","7"],["value","30"],["value","90"],["value","180"],["value","365"],["value","-1"],[1,"button-group"],["type","button",1,"cancel-button",3,"click"],["type","submit",3,"disabled"]],template:function(o,a){o&1&&u(0,ce,35,3,"div",0),o&2&&m("ngIf",a.isOpen)},dependencies:[w,ee,Z,q,oe,re,j,ie,G,L,z,H],styles:[".dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.dialog-content[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:8px;width:90%;max-width:500px;box-shadow:0 4px 6px #0000001a}h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:#e74c3c}.user-email[_ngcontent-%COMP%]{color:#666;margin-bottom:1.5rem;font-style:italic}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;color:#333}textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #ddd;border-radius:4px;font-family:inherit}textarea[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{outline:none;border-color:#e74c3c;box-shadow:0 0 0 2px #e74c3c33}.button-group[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end}button[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:4px;cursor:pointer;font-weight:500}button[type=submit][_ngcontent-%COMP%]{background:#e74c3c;color:#fff}.cancel-button[_ngcontent-%COMP%]{background:#eee;color:#333}button[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}"]})}}return t})();var U=(()=>{class t{constructor(e){this.http=e,this.apiUrl="https://jurasickparkmanagement.onrender.com"}getUserProfile(){return this.http.get(`${this.apiUrl}/profile`)}updateProfile(e){return this.http.put(`${this.apiUrl}/profile`,e)}changePassword(e){return this.http.put(`${this.apiUrl}/profile/password`,e)}resetPark(){return this.http.post(`${this.apiUrl}/profile/reset-park`,{})}getUsers(){return this.http.get(`${this.apiUrl}/users`)}changeUserRole(e,o){return this.http.put(`${this.apiUrl}/users/${e}/role`,{role:o})}deleteUser(e){return this.http.delete(`${this.apiUrl}/users/${e}`)}banUser(e,o){return this.http.post(`${this.apiUrl}/users/${e}/ban`,o)}unbanUser(e){return this.http.post(`${this.apiUrl}/users/${e}/unban`,{})}static{this.\u0275fac=function(o){return new(o||t)(X(te))}}static{this.\u0275prov=W({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var ue=(t,s)=>s.id;function fe(t,s){if(t&1&&(r(0),$(1,"date")),t&2){let e=d(2).$implicit;O(" until ",A(1,1,e.banInfo==null?null:e.banInfo.bannedUntil)," ")}}function be(t,s){t&1&&r(0," permanently ")}function ge(t,s){if(t&1&&(n(0,"span",11),r(1," Banned "),u(2,fe,2,3)(3,be,1,0),i()),t&2){let e=d().$implicit;l(2),g(e.banInfo!=null&&e.banInfo.bannedUntil?2:3)}}function _e(t,s){t&1&&(n(0,"span",12),r(1,"Active"),i())}function he(t,s){if(t&1){let e=P();n(0,"button",14),c("click",function(){x(e);let a=d().$implicit,p=d();return v(p.openBanDialog(a))}),r(1),i(),n(2,"button",15),c("click",function(){x(e);let a=d().$implicit,p=d();return v(p.deleteUser(a))}),r(3," Delete "),i()}if(t&2){let e=d().$implicit;B("banned",e.banned),l(),O(" ",e.banned?"Unban":"Ban"," ")}}function Ce(t,s){if(t&1){let e=P();n(0,"tr")(1,"td"),r(2),i(),n(3,"td")(4,"select",7),c("change",function(a){let p=x(e).$implicit,M=d();return v(M.changeRole(p,a))}),n(5,"option",8),r(6,"User"),i(),n(7,"option",9),r(8,"Admin"),i(),n(9,"option",10),r(10,"Owner"),i()()(),n(11,"td"),u(12,ge,4,1,"span",11)(13,_e,2,0,"span",12),i(),n(14,"td",13),u(15,he,4,3),i()()}if(t&2){let e=s.$implicit;l(2),S(e.email),l(2),m("value",e.rol)("disabled",e.rol==="Owner"),l(8),g(e.banned?12:13),l(3),g(e.rol!=="Owner"?15:-1)}}var le=(()=>{class t{constructor(e){this.profileService=e,this.users=[],this.showBanDialog=!1,this.selectedUser=null}ngOnInit(){this.loadUsers()}loadUsers(){this.profileService.getUsers().subscribe(e=>{this.users=e.map(o=>y(E({},o),{banInfo:o.banInfo?y(E({},o.banInfo),{bannedAt:new Date(o.banInfo.bannedAt).toISOString(),bannedUntil:o.banInfo.bannedUntil?new Date(o.banInfo.bannedUntil).toISOString():null}):null})),console.log("usuarios transformados ",this.users)})}openBanDialog(e){e.banned?this.unbanUser(e):(this.selectedUser=e,this.showBanDialog=!0)}closeBanDialog(){this.showBanDialog=!1,this.selectedUser=null}confirmBan(e){this.selectedUser&&(console.log("Duracion de ban desde confirm ban owner ",e.duration),this.profileService.banUser(this.selectedUser.id,e).subscribe(()=>{this.loadUsers(),this.closeBanDialog()}))}unbanUser(e){this.profileService.unbanUser(e.id).subscribe(()=>{let o=this.users.findIndex(a=>a.id===e.id);o!==-1&&(this.users[o]=y(E({},e),{banned:!1,banInfo:null}))})}changeRole(e,o){let a=o.target.value;this.profileService.changeUserRole(e.id,a).subscribe(()=>{this.loadUsers()})}deleteUser(e){confirm(`Are you sure you want to delete ${e.email}?`)&&this.profileService.deleteUser(e.id).subscribe(()=>{this.loadUsers()})}static{this.\u0275fac=function(o){return new(o||t)(b(U))}}static{this.\u0275cmp=_({type:t,selectors:[["owner-panel"]],standalone:!0,features:[h],decls:24,vars:2,consts:[[1,"owner-card"],[1,"header"],["routerLink","/park-management",1,"manage-park-button"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M3 12h18M12 3l7 9-7 9"],[1,"user-list"],[3,"close","confirm","isOpen","userEmail"],[3,"change","value","disabled"],["value","User"],["value","Admin"],["value","Owner"],[1,"banned-status"],[1,"active-status"],[1,"actions"],[3,"click"],[1,"delete",3,"click"]],template:function(o,a){o&1&&(n(0,"div",0)(1,"div",1)(2,"h2"),r(3,"Full User Management"),i(),n(4,"button",2),r(5," Manage Park Content "),F(),n(6,"svg",3),f(7,"path",4),i()()(),D(),n(8,"div",5)(9,"table")(10,"thead")(11,"tr")(12,"th"),r(13,"Email"),i(),n(14,"th"),r(15,"Role"),i(),n(16,"th"),r(17,"Status"),i(),n(18,"th"),r(19,"Actions"),i()()(),n(20,"tbody"),I(21,Ce,16,5,"tr",null,ue),i()()(),n(23,"ban-dialog",6),c("close",function(){return a.closeBanDialog()})("confirm",function(M){return a.confirmBan(M)}),i()()),o&2&&(l(21),T(a.users),l(2),m("isOpen",a.showBanDialog)("userEmail",(a.selectedUser==null?null:a.selectedUser.email)||""))},dependencies:[w,V,J,R,N],styles:[".owner-card[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:8px;box-shadow:0 2px 4px #0000001a}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.manage-park-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;background:#2a623d;color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:500;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 4px #0000001a}.manage-park-button[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 6px #00000026;background:#1a472a}.manage-park-button[_ngcontent-%COMP%]:active{transform:translateY(0);box-shadow:0 2px 4px #0000001a}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem;text-align:left;border-bottom:1px solid #eee}select[_ngcontent-%COMP%]{padding:.5rem;border-radius:4px;border:1px solid #ddd}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:4px;cursor:pointer}button.banned[_ngcontent-%COMP%]{background:#2ecc71;color:#fff}button[_ngcontent-%COMP%]:not(.banned):not(.manage-park-button){background:#e74c3c;color:#fff}button.delete[_ngcontent-%COMP%]{background:#c0392b;color:#fff}.banned-status[_ngcontent-%COMP%]{color:#e74c3c;font-weight:500}.active-status[_ngcontent-%COMP%]{color:#2ecc71;font-weight:500}"]})}}return t})();var xe=(t,s)=>s.id;function ve(t,s){if(t&1&&(r(0),$(1,"date")),t&2){let e=d(3).$implicit;O(" until ",A(1,1,e.banInfo==null?null:e.banInfo.bannedUntil)," ")}}function we(t,s){t&1&&r(0," permanently ")}function Pe(t,s){if(t&1&&(n(0,"span",3),r(1," Banned "),u(2,ve,2,3)(3,we,1,0),i()),t&2){let e=d(2).$implicit;l(2),g(e.banInfo!=null&&e.banInfo.bannedUntil?2:3)}}function Se(t,s){t&1&&(n(0,"span",4),r(1,"Active"),i())}function Oe(t,s){if(t&1){let e=P();n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),u(6,Pe,4,1,"span",3)(7,Se,2,0,"span",4),i(),n(8,"td")(9,"button",5),c("click",function(){x(e);let a=d().$implicit,p=d();return v(p.openBanDialog(a))}),r(10),i()()()}if(t&2){let e=d().$implicit;l(2),S(e.email),l(2),S(e.rol),l(2),g(e.banned?6:7),l(3),B("banned",e.banned),l(),O(" ",e.banned?"Unban":"Ban"," ")}}function Ue(t,s){if(t&1&&u(0,Oe,11,6,"tr"),t&2){let e=s.$implicit;g(e.rol==="User"?0:-1)}}var se=(()=>{class t{constructor(e){this.profileService=e,this.users=[],this.showBanDialog=!1,this.selectedUser=null}ngOnInit(){this.loadUsers()}loadUsers(){this.profileService.getUsers().subscribe(e=>{this.users=e,console.log(e)})}openBanDialog(e){console.log("Usuario de user profile,",e),e.banned?this.unbanUser(e):(this.selectedUser=e,this.showBanDialog=!0)}closeBanDialog(){this.showBanDialog=!1,this.selectedUser=null}confirmBan(e){this.selectedUser&&(console.log("usuario ban ",this.selectedUser.banInfo),this.profileService.banUser(this.selectedUser.id,e).subscribe(()=>{this.loadUsers(),this.closeBanDialog()}))}unbanUser(e){this.profileService.unbanUser(e.id).subscribe(()=>{this.loadUsers()})}static{this.\u0275fac=function(o){return new(o||t)(b(U))}}static{this.\u0275cmp=_({type:t,selectors:[["admin-panel"]],standalone:!0,features:[h],decls:19,vars:2,consts:[[1,"admin-card"],[1,"user-list"],[3,"close","confirm","isOpen","userEmail"],[1,"banned-status"],[1,"active-status"],[3,"click"]],template:function(o,a){o&1&&(n(0,"div",0)(1,"h2"),r(2,"User Management"),i(),n(3,"div",1)(4,"table")(5,"thead")(6,"tr")(7,"th"),r(8,"Email"),i(),n(9,"th"),r(10,"Role"),i(),n(11,"th"),r(12,"Status"),i(),n(13,"th"),r(14,"Actions"),i()()(),n(15,"tbody"),I(16,Ue,1,1,null,null,xe),i()()(),n(18,"ban-dialog",2),c("close",function(){return a.closeBanDialog()})("confirm",function(M){return a.confirmBan(M)}),i()()),o&2&&(l(16),T(a.users),l(2),m("isOpen",a.showBanDialog)("userEmail",(a.selectedUser==null?null:a.selectedUser.email)||""))},dependencies:[w,V,J],styles:[".admin-card[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:8px;box-shadow:0 2px 4px #0000001a}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem;text-align:left;border-bottom:1px solid #eee}button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:4px;cursor:pointer;background:#e74c3c;color:#fff}button.banned[_ngcontent-%COMP%]{background:#2ecc71}.banned-status[_ngcontent-%COMP%]{color:#e74c3c;font-weight:500}.active-status[_ngcontent-%COMP%]{color:#2ecc71;font-weight:500}"]})}}return t})();var de=(()=>{class t{constructor(e,o){this.fb=e,this.profileService=o,this.email="",this.profileForm=this.fb.group({parkName:["",[C.required,C.minLength(3)]]}),this.passwordForm=this.fb.group({currentPassword:["",[C.required]],newPassword:["",[C.required,C.minLength(6)]]}),this.loadUserProfile()}loadUserProfile(){this.profileService.getUserProfile().subscribe(e=>{this.email=e.email,this.profileForm.patchValue({parkName:e.parkName})})}onSubmit(){this.profileForm.valid&&this.profileService.updateProfile(this.profileForm.value).subscribe()}onPasswordChange(){this.passwordForm.valid&&this.profileService.changePassword(this.passwordForm.value).subscribe()}resetPark(){confirm("Are you sure you want to reset your park? This action cannot be undone.")&&this.profileService.resetPark().subscribe()}static{this.\u0275fac=function(o){return new(o||t)(b(Y),b(U))}}static{this.\u0275cmp=_({type:t,selectors:[["user-profile"]],standalone:!0,features:[h],decls:33,vars:5,consts:[[1,"profile-card"],[3,"ngSubmit","formGroup"],[1,"form-group"],["type","email","disabled","",3,"value"],["type","text","formControlName","parkName"],["type","submit",3,"disabled"],[1,"password-section"],["type","password","formControlName","currentPassword"],["type","password","formControlName","newPassword"],[1,"danger-zone"],[1,"reset-button",3,"click"]],template:function(o,a){o&1&&(n(0,"div",0)(1,"h2"),r(2,"Profile Settings"),i(),n(3,"form",1),c("ngSubmit",function(){return a.onSubmit()}),n(4,"div",2)(5,"label"),r(6,"Email"),i(),f(7,"input",3),i(),n(8,"div",2)(9,"label"),r(10,"Park Name"),i(),f(11,"input",4),i(),n(12,"button",5),r(13," Save Changes "),i()(),n(14,"div",6)(15,"h3"),r(16,"Change Password"),i(),n(17,"form",1),c("ngSubmit",function(){return a.onPasswordChange()}),n(18,"div",2)(19,"label"),r(20,"Current Password"),i(),f(21,"input",7),i(),n(22,"div",2)(23,"label"),r(24,"New Password"),i(),f(25,"input",8),i(),n(26,"button",5),r(27," Update Password "),i()()(),n(28,"div",9)(29,"h3"),r(30,"Danger Zone"),i(),n(31,"button",10),c("click",function(){return a.resetPark()}),r(32," Reset Park Progress "),i()()()),o&2&&(l(3),m("formGroup",a.profileForm),l(4),m("value",a.email),l(5),m("disabled",a.profileForm.invalid),l(5),m("formGroup",a.passwordForm),l(9),m("disabled",a.passwordForm.invalid))},dependencies:[Z,q,j,G,L,z,H,w],styles:[".profile-card[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:8px;box-shadow:0 2px 4px #0000001a}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;color:#333}input[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #ddd;border-radius:4px}input[_ngcontent-%COMP%]:disabled{background:#f5f5f5}button[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:#2a623d;color:#fff;border:none;border-radius:4px;cursor:pointer}.password-section[_ngcontent-%COMP%], .danger-zone[_ngcontent-%COMP%]{margin-top:2rem;padding-top:2rem;border-top:1px solid #eee}.reset-button[_ngcontent-%COMP%]{background:#e74c3c}"]})}}return t})();function Me(t,s){t&1&&f(0,"admin-panel")}function ke(t,s){t&1&&f(0,"owner-panel")}var Xe=(()=>{class t{constructor(e){this.authService=e,this.userRole="User",this.authService.currentUser$.subscribe(o=>{o&&(console.log("User desde profile",o),this.userRole=o.rol)})}static{this.\u0275fac=function(o){return new(o||t)(b(ne))}}static{this.\u0275cmp=_({type:t,selectors:[["profile"]],standalone:!0,features:[h],decls:8,vars:2,consts:[[1,"profile-container"],["routerLink","/park","title","Return to Park",1,"back-button"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M19 12H5M12 19l-7-7 7-7"],[1,"profile-content"]],template:function(o,a){o&1&&(n(0,"div",0)(1,"a",1),F(),n(2,"svg",2),f(3,"path",3),i()(),D(),n(4,"div",4),f(5,"user-profile"),u(6,Me,1,0,"admin-panel")(7,ke,1,0,"owner-panel"),i()()),o&2&&(l(6),g(a.userRole==="Admin"?6:-1),l(),g(a.userRole==="Owner"?7:-1))},dependencies:[le,se,de,R,N],styles:[".profile-container[_ngcontent-%COMP%]{min-height:100vh;background:#f0f2f5;padding:2rem;position:relative}.profile-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;display:grid;gap:2rem}.back-button[_ngcontent-%COMP%]{position:fixed;top:1rem;left:1rem;display:flex;align-items:center;justify-content:center;width:40px;height:40px;background:#fff;border-radius:50%;box-shadow:0 2px 4px #0000001a;color:#2a623d;transition:transform .2s;z-index:100}.back-button[_ngcontent-%COMP%]:hover{transform:scale(1.05)}"]})}}return t})();export{Xe as ProfileComponent};
